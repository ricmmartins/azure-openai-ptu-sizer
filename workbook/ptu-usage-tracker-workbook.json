{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "TimeRange",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 86400000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 2592000000
                }
              ],
              "allowCustom": true
            },
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 0"
    },
    {
      "type": 1,
      "content": {
        "json": "# Azure OpenAI PTU Usage Tracker\n\nAnalyze your Azure OpenAI token usage patterns and get PTU sizing recommendations.\n\nðŸ“Š **Key Metrics**: Real-time token analysis â€¢ PTU recommendations â€¢ Cost comparisons â€¢ Performance insights"
      },
      "name": "Header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "AzureDiagnostics\n| where ResourceProvider == \"MICROSOFT.COGNITIVESERVICES\"\n| where Category == \"RequestResponse\"\n| summarize RequestCount = count() by bin(TimeGenerated, 1h)\n| render timechart \n    with (title=\"API Requests Over Time\", xtitle=\"Time\", ytitle=\"Request Count\")",
        "size": 0,
        "title": "ðŸ”¥ API Request Volume",
        "timeContext": {
          "durationMs": 86400000
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "RequestVolume"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "AzureMetrics\n| where ResourceProvider == \"MICROSOFT.COGNITIVESERVICES\"\n| where MetricName in (\"ProcessedPromptTokens\", \"ProcessedCompletionTokens\")\n| summarize \n    PromptTokens = sumif(Total, MetricName == \"ProcessedPromptTokens\"),\n    CompletionTokens = sumif(Total, MetricName == \"ProcessedCompletionTokens\")\n| extend TotalTokens = PromptTokens + CompletionTokens\n| extend EstimatedPTUs = toint((TotalTokens + 49999) / 50000)\n| project PromptTokens, CompletionTokens, TotalTokens, EstimatedPTUs",
        "size": 0,
        "title": "ðŸ“¦ Token Summary & PTU Recommendation",
        "timeContext": {
          "durationMs": 86400000
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "TokenSummary"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "AzureMetrics\n| where ResourceProvider == \"MICROSOFT.COGNITIVESERVICES\"\n| where MetricName in (\"ProcessedPromptTokens\", \"ProcessedCompletionTokens\")\n| summarize \n    PromptTokens = sumif(Total, MetricName == \"ProcessedPromptTokens\"),\n    CompletionTokens = sumif(Total, MetricName == \"ProcessedCompletionTokens\")\n    by bin(TimeGenerated, 1h)\n| extend TotalTokens = PromptTokens + CompletionTokens\n| extend EstimatedPTUs = toint((TotalTokens + 49999) / 50000)\n| project TimeGenerated, EstimatedPTUs\n| render timechart with (title=\"ðŸ“ˆ Estimated PTU Usage per Hour\", xtitle=\"Time\", ytitle=\"PTUs\")",
        "size": 0,
        "title": "ðŸ“Š PTU Trend by Hour",
        "timeContext": {
          "durationMs": 86400000
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "PTUTrendChart"
    },
    {
      "type": 1,
      "content": {
        "json": "## ðŸ“‹ PTU Decision Guide\n\n**When to consider PTU:**\n- âœ… Consistent high-volume usage (>50K tokens/day)\n- âœ… Predictable workload patterns\n- âœ… Need guaranteed throughput/low latency\n- âœ… Rate limiting issues with pay-per-token\n\n**PTU Sizing Guidelines:**\n- **PTU-100**: ~6,000 tokens/minute sustained\n- **PTU-300**: ~18,000 tokens/minute sustained\n- **PTU-500**: ~30,000 tokens/minute sustained\n\n**Cost Breakeven Points (approximate):**\n- PTU-100: ~240K tokens/day\n- PTU-300: ~720K tokens/day\n- PTU-500: ~1.2M tokens/day\n\nðŸ’¡ **Formula**: `EstimatedPTUs = ceil(total_tokens_per_minute / 50000)`"
      },
      "name": "PTUDecisionGuide"
    }
  ],
  "fallbackResourceIds": [],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
